

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="zelong xia">
  <meta name="keywords" content="">
  
    <meta name="description" content="Why should reduce code size? Size limit from distribution platform, for example, Googel Play, apk limit size is 100MB. Improve program performance, lower memory and disk usage. Reduce costs of custome">
<meta property="og:type" content="article">
<meta property="og:title" content="Reduce code zize">
<meta property="og:url" content="http://xiazelong.com/2022/09/16/reduce-code-size/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Why should reduce code size? Size limit from distribution platform, for example, Googel Play, apk limit size is 100MB. Improve program performance, lower memory and disk usage. Reduce costs of custome">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://xiazelong.com/2022/09/16/reduce-code-size/user_conversion_rate.jpg">
<meta property="og:image" content="http://xiazelong.com/2022/09/16/reduce-code-size/protobuf-lib.png">
<meta property="og:image" content="http://xiazelong.com/2022/09/16/reduce-code-size/protobuf-gen-code-cpp.png">
<meta property="og:image" content="http://xiazelong.com/2022/09/16/reduce-code-size/proto-c.png">
<meta property="og:image" content="http://xiazelong.com/2022/09/16/reduce-code-size/proto-c-gen.png">
<meta property="article:published_time" content="2022-09-16T02:26:59.841Z">
<meta property="article:modified_time" content="2022-09-16T02:26:59.841Z">
<meta property="article:author" content="zelong xia">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://xiazelong.com/2022/09/16/reduce-code-size/user_conversion_rate.jpg">
  
  
  
  <title>Reduce code zize - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xiazelong.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>zelong xia&#39;s tech blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Reduce code zize"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-09-16 10:26" pubdate>
          September 16, 2022 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          10k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          86 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Reduce code zize</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="Why-should-reduce-code-size"><a href="#Why-should-reduce-code-size" class="headerlink" title="Why should reduce code size?"></a>Why should reduce code size?</h2><ol>
<li>Size limit from distribution platform, for example, Googel Play, apk limit size is 100MB.</li>
<li>Improve program performance, lower memory and disk usage.</li>
<li>Reduce costs of customer acquisition, smaller app size, higher the user conversion rate.</li>
</ol>
<p><img src="/2022/09/16/reduce-code-size/user_conversion_rate.jpg" srcset="/img/loading.gif" lazyload></p>
<h2 id="How-to-reduce-code-size"><a href="#How-to-reduce-code-size" class="headerlink" title="How to reduce code size?"></a>How to reduce code size?</h2><p>This article descriptes how to reduce size of android dynamic library and iOS link-map.</p>
<h3 id="Packaging-on-depends"><a href="#Packaging-on-depends" class="headerlink" title="Packaging on depends"></a>Packaging on depends</h3><p>Your app or SDK has a lot of functions, customers only need some of these features, packaging app&#x2F;SDK as needed is necessary. Like most open source projects, configuration file determines which modules need to be compiled and linked. Module boundaries must be clear, code must be low coupled. Here show how to configure porject file:<br>iOS: <a target="_blank" rel="noopener" href="https://github.com/kronenthaler/mod-pbxproj">https://github.com/kronenthaler/mod-pbxproj</a>, .pch file is easy way to define macro.<br>Android: Application.mk, <a target="_blank" rel="noopener" href="https://developer.android.com/ndk/guides/application_mk">https://developer.android.com/ndk/guides/application_mk</a>, APP_xxx is more convenient compared to LOCAL_XXX.<br>Windows: <a target="_blank" rel="noopener" href="https://github.com/marktsuchida/vcxproj-stream-editor">https://github.com/marktsuchida/vcxproj-stream-editor</a>, vcxproj is xml file, you can use python script to parse and replace.</p>
<p>For example, </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">## Application.mk </span><br>IS_SUPPORT_AAC :=<span class="hljs-literal">false</span><br><br><span class="hljs-title function_ invoke__">ifeq</span> ($(IS_SUPPORT_AAC),<span class="hljs-literal">true</span>)<br>APP_CFLAGS += -DAV_USE_AAC_CODEC<br><span class="hljs-keyword">endif</span><br><br><br><span class="hljs-comment">## Android.mk of Engine module</span><br><span class="hljs-title function_ invoke__">ifeq</span> ($(IS_SUPPORT_AAC),<span class="hljs-literal">true</span>)<br>LOCAL_STATIC_LIBRARIES += libaac<br><span class="hljs-keyword">endif</span><br><br><span class="hljs-title function_ invoke__">ifeq</span> ($(IS_SUPPORT_AAC),<span class="hljs-literal">true</span>)<br><span class="hljs-keyword">include</span> $(ENGINE_SRC_PATH)/<span class="hljs-number">3</span>rd/audiocodec/libaacplus/build/Android/Android.mk<br><span class="hljs-keyword">endif</span><br><br><br><span class="hljs-comment">## Decode.cpp</span><br><span class="hljs-comment">#ifdef AV_USE_AAC_CODEC	</span><br><span class="hljs-comment">/*5*/</span>		&#123;<span class="hljs-number">48000</span>, <span class="hljs-number">2</span>, <span class="hljs-number">16</span>, <span class="hljs-number">20</span>*<span class="hljs-number">10000</span>, PAR_TYPE_EAACPLUS_AUDIO, AUTOENC_RATE_EAACP_SSWB_ST, AUTOENC_STEREO_MODE_ST, <span class="hljs-title class_">CEAACPLUSEnc</span>::<span class="hljs-variable constant_">CreateEnc</span>, <span class="hljs-title class_">CEAACPLUSEnc</span>::<span class="hljs-variable constant_">CalcOutBufSize</span>&#125;,<br><span class="hljs-comment">/*6*/</span>		&#123;<span class="hljs-number">48000</span>, <span class="hljs-number">2</span>, <span class="hljs-number">16</span>, <span class="hljs-number">20</span>*<span class="hljs-number">10000</span>, PAR_TYPE_EAACPLUS_AUDIO, AUTOENC_RATE_EAACP_SSSWB_ST, AUTOENC_STEREO_MODE_ST, <span class="hljs-title class_">CEAACPLUSEnc</span>::<span class="hljs-variable constant_">CreateEnc</span>, <span class="hljs-title class_">CEAACPLUSEnc</span>::<span class="hljs-variable constant_">CalcOutBufSize</span>&#125;,<br><span class="hljs-comment">#else</span><br>		    &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>&#125;,<br>            &#123;<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,  <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>&#125;,<br><span class="hljs-comment">#endif</span><br></code></pre></td></tr></table></figure>

<h3 id="–gc-section"><a href="#–gc-section" class="headerlink" title="–gc-section"></a>–gc-section</h3><p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gnat_ugn/Compilation-options.html">gc-section</a>,the operation of eliminating the unused code and data from the final executable is directly performed by the linker.</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment">## Application.mk </span><br>IS_ENABLE_GC_SECTION :=true<br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(IS_ENABLE_GC_SECTION)</span>, true)<br>APP_CPPFLAGS += -ffunction-sections -fdata-sections<br>APP_CFLAGS += -ffunction-sections -fdata-sections<br>APP_LDFLAGS += -Wl,--gc-sections<br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>
<h3 id="Clipping-symbols-exported"><a href="#Clipping-symbols-exported" class="headerlink" title="Clipping symbols exported"></a>Clipping symbols exported</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">## Application.mk </span><br><span class="hljs-attribute">APP_LDFLAGS</span> += -Wl,--exclude-libs,<span class="hljs-literal">ALL</span><br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://linux.die.net/man/1/ld">–exclude-libs</a> make all symbols in static library not exported. if you want to customize the export symbol table, <a target="_blank" rel="noopener" href="https://www.gnu.org/software/gnulib/manual/html_node/LD-Version-Scripts.html">version script</a> is helpful.</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs stata">## version_script.<span class="hljs-keyword">conf</span><br>LIBFOO_1.0 &#123;<br>  <span class="hljs-keyword">global</span>:<br>    func1; func2; func3;...<br><br>  <span class="hljs-keyword">local</span>:<br><span class="hljs-comment">    *;</span><br>&#125;;<br><br>## Application.mk <br><span class="hljs-keyword">if</span> HAVE_LD_VERSION_SCRIPT<br>APP_LDFLAGS += -Wl,--<span class="hljs-keyword">version</span>-script=$(srcdir)/version_script.<span class="hljs-keyword">conf</span><br>endif<br></code></pre></td></tr></table></figure>

<h3 id="LTO-Link-time-optimize"><a href="#LTO-Link-time-optimize" class="headerlink" title="LTO(Link-time optimize)"></a>LTO(Link-time optimize)</h3><p>The basic principle behind <a href="(https://gcc.gnu.org/onlinedocs/gcc-4.6.3/gccint/LTO.html)">LTO</a> is that some optimization passes are pushed back to the linking stage. Why the linking stage? Because that is the point in the pipeline where the entire program (i.e. the whole set of compilation units) is available at once and thus optimizations across compilation unit boundaries become possible.</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment">## Application.mk </span><br>IS_ENABLE_LTO :=true<br><br><span class="hljs-comment">## Android.mk of module </span><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(IS_ENABLE_LTO)</span>, true)<br><span class="hljs-keyword">ifneq</span> (,<span class="hljs-variable">$(<span class="hljs-built_in">filter</span> <span class="hljs-variable">$(TARGET_ARCH_ABI)</span>,x86 arm64-v8a x86_64)</span>)<br><span class="hljs-variable">$(<span class="hljs-built_in">warning</span> &quot;<span class="hljs-variable">$(TARGET_ARCH_ABI)</span> enable lto&quot;)</span><br>LOCAL_CPPFLAGS += -flto=thin<br>LOCAL_CFLAGS += -flto=thin<br><span class="hljs-keyword">endif</span><br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>
<p>After LTO enabled, smaller code size and higher performance. But, slower link speed and poorer debug ability.</p>
<h3 id="Exception-RTTI-Oz"><a href="#Exception-RTTI-Oz" class="headerlink" title="Exception\RTTI\-Oz"></a>Exception\RTTI\-Oz</h3><p>C++ lauguage supports exception and RTTI(Runtime Type Identification), if your project does’t use them, please disable them. </p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment">## Application.mk </span><br>IS_ENABLE_EXCPTION :=false<br>IS_ENABLE_RTTI :=false<br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(IS_ENABLE_EXCPTION)</span>, true)<br>APP_CPPFLAGS += -fexceptions<br>APP_CFLAGS += -DAV_SUPPORT_EXCEPTION<br><span class="hljs-keyword">else</span><br>APP_CPPFLAGS += -fno-exceptions<br><span class="hljs-keyword">endif</span><br><br><span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(IS_ENABLE_RTTI)</span>, true)<br>APP_CPPFLAGS += -frtti<br>APP_CFLAGS += -DAV_SUPPORT_RTTI<br><span class="hljs-keyword">else</span><br>APP_CPPFLAGS += -fno-rtti<br><span class="hljs-keyword">endif</span><br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/CommandGuide/clang.html">Code Generation Options</a>,<br>-O0: no optimization, generates the most debuggable code.<br>-O1: Somewhere between -O0 and -O2.<br>-O2: Moderate level of optimization which enables most optimizations.<br>…<br>-Os Like -O2 with extra optimizations to reduce code size.<br>-Oz Like -Os (and thus -O2), but reduces code size further.</p>
<p>-Oz generate smaller code size that -Os, but slight and acceptable performance penalty. If -Oz is set, need to do adequate performance test.</p>
<h3 id="Resuorces"><a href="#Resuorces" class="headerlink" title="Resuorces"></a>Resuorces</h3><p>The resources the code depending on can be download from remote server or CDN, therefor, Digging resources out of code can also reduce code size. For example, Algorithm Model and String.</p>
<p>Stripping log strings as example, here is the steps:<br>Firstly, Using python script to strip log string from code before compiling, save the striped strings as a resource file, <a href="#appendix">ptyhon script</a>.<br>And secondly, After SDK or module is loaded,  try to load string resource file from local disk, if it is not exist, download it from remote.</p>
<p>The <strong>benefits</strong>:</p>
<ol>
<li>Size of the code is reduced;</li>
<li>Not all the businesses need print log;</li>
<li>More secure, logs is an important way to reverse engineering;</li>
<li>More easier to achieve internationalization.</li>
</ol>
<p>The code of logging before string stripping:</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">std::<span class="hljs-built_in">string</span> str = ...;<br><span class="hljs-constructor">LOG_I(<span class="hljs-string">&quot;here is a string, len=%d&quot;</span>, <span class="hljs-params">str</span>.<span class="hljs-params">length</span>()</span>);<br></code></pre></td></tr></table></figure>

<p>The code of logging after string stripping:</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> str = ...;<br>LOG_I(STRING_MAPPING(<span class="hljs-number">2</span>), str.<span class="hljs-built_in">length</span>());<br></code></pre></td></tr></table></figure>
<p>The resource file of the string, rc4 encryption.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">1,U2FsdGVkX1+7pwfzVJ/n6WFScsqrrk7D6aLJKlE=<br>2,U2FsdGVkX19Zmw0mG74+hNNfbZpLbrfdgp+dhx8kdQ9R3hTDjVqdkQ==<br>3,U2FsdGVkX1+7pwfzVJ/n6WFScsqrrk7D6aLJKlE=<br>...<br></code></pre></td></tr></table></figure>
<h3 id="Lightweight-implementation"><a href="#Lightweight-implementation" class="headerlink" title="Lightweight implementation"></a>Lightweight implementation</h3><ol>
<li>Avoid using C++ STL, expecially std::ostringstream;</li>
<li>C language open source has a higher priority, cJson&#x2F;protobuf-c&#x2F;… rather than rapidjson&#x2F;protobuf-c++&#x2F;…;</li>
<li>Call directly, donot overwrap, open source like ffmpeg&#x2F;webrtc are too huge, Donot use an ox-cleaver to kill a chicken.</li>
</ol>
<p>Data serialization for example, <a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers">protobuf</a> is used a lot, code size has two parts, one part is library, another part is generated cpp proto files. </p>
<p>If your project doesn’t using reflection, protobuf-lite is better chooise.<br><img src="/2022/09/16/reduce-code-size/protobuf-lib.png" srcset="/img/loading.gif" lazyload><br><img src="/2022/09/16/reduce-code-size/protobuf-gen-code-cpp.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">## proto file<br><span class="hljs-keyword">option</span> optimize_for = LITE_RUNTIME; # add in the first line<br><span class="hljs-keyword">message </span><span class="hljs-title class_">VoipClient2AccessHead</span><br>&#123;<br>	<span class="hljs-keyword">optional</span> <span class="hljs-type">uint32</span> cmdtype = <span class="hljs-number">1</span>;<br>	<span class="hljs-keyword">optional</span> <span class="hljs-type">uint32</span> version = <span class="hljs-number">2</span>;<br>	<span class="hljs-keyword">optional</span> <span class="hljs-type">uint64</span> roomid = <span class="hljs-number">3</span>;<br>	<span class="hljs-keyword">optional</span> <span class="hljs-type">uint32</span> memberid = <span class="hljs-number">4</span>;<br>...<br>&#125;<br></code></pre></td></tr></table></figure>
<p>With protobuf-lite, Code size is significantly reduced, especially libarary size, the point is not to change your code. If your project has a amount of proto files, <a target="_blank" rel="noopener" href="https://github.com/protobuf-c/protobuf-c">protobuf-c</a> is better chooise.<br><img src="/2022/09/16/reduce-code-size/proto-c.png" srcset="/img/loading.gif" lazyload><br><img src="/2022/09/16/reduce-code-size/proto-c-gen.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/python3</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br>import sys<br>import os<br>import os.path<br><br>fileList = []<br>filter = &#123;<span class="hljs-string">&#x27;.cpp&#x27;</span>,<span class="hljs-string">&#x27;.c&#x27;</span>,<span class="hljs-string">&#x27;.cxx&#x27;</span>,<span class="hljs-string">&#x27;.C&#x27;</span>,<span class="hljs-string">&#x27;.h&#x27;</span>,<span class="hljs-string">&#x27;.hpp&#x27;</span>,<span class="hljs-string">&#x27;.hxx&#x27;</span>&#125; <span class="hljs-comment"># suffix of code file</span><br>prefix_filter = &#123;<span class="hljs-string">&#x27;LOG_&#x27;</span>,<span class="hljs-string">&#x27;Q_&#x27;</span>&#125; <span class="hljs-comment"># prefix of the print-log-function</span><br>index_string_macro = <span class="hljs-string">&quot;STRING_MAPPING&quot;</span> <span class="hljs-comment"># Macro name to mapping int to string</span><br><br>string_resource_index = 0<br>string_resource_map = &#123;&#125;<br><br>def pack_string(str):<br>    global string_resource_index<br>    global string_resource_map <br>    <span class="hljs-keyword">if</span> str not <span class="hljs-keyword">in</span> string_resource_map:<br>        string_resource_map[str] = string_resource_index<br>        string_resource_index += 1<br>    <span class="hljs-built_in">return</span> string_resource_map[str]<br>    <br>def find_string_from_line(in_line,out_line):<br>    begin = in_line.find(<span class="hljs-string">&#x27;&quot;&#x27;</span>)<br>    end = -1<br>    <span class="hljs-keyword">if</span> begin &gt;= 0:<br>        end = in_line.find(<span class="hljs-string">&#x27;&quot;&#x27;</span>,begin+1)<br>        <span class="hljs-keyword">while</span> end &gt; 0:<br>            <span class="hljs-comment">#case like &quot;xxxx\&quot;xxx\&quot;xxx&quot;</span><br>            <span class="hljs-keyword">if</span> in_line[end-1] == <span class="hljs-string">&#x27;\\&#x27;</span>:<br>                end = in_line.find(<span class="hljs-string">&#x27;&quot;&#x27;</span>,end+1)<br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-built_in">break</span><br>        <span class="hljs-comment">#case no string</span><br>        <span class="hljs-keyword">if</span> end &lt; 0:<br>            out_line += in_line<br>            <span class="hljs-comment">#print &quot;if end &lt; 0&quot;</span><br>            <span class="hljs-built_in">return</span> out_line<br>        <span class="hljs-comment">#case like &quot;xxxx&quot;</span><br>        <span class="hljs-keyword">elif</span> end &gt; begin+1:<br>            <span class="hljs-comment">#print &quot;end &gt; begin+1&quot;</span><br>            <span class="hljs-comment">#print in_line[begin:end+1]</span><br>            out_line += in_line[0:begin]<br>            out_line += (index_string_macro + <span class="hljs-string">&quot;(&quot;</span> + str(pack_string(in_line[begin:end+1])) + <span class="hljs-string">&quot;)&quot;</span>)<br>        <span class="hljs-comment">#case like &quot;&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment">#print &quot;\&quot;\&quot;&quot;</span><br>            out_line += in_line[:end+1]<br>        out_line = find_string_from_line(in_line[end+1:],out_line)<br>    <span class="hljs-comment">#case no string</span><br>    <span class="hljs-keyword">else</span>:<br>        out_line += in_line<br>        <span class="hljs-comment">#print &quot;none&quot; </span><br>    <span class="hljs-comment">#print &quot;return:&quot; + out_line</span><br>    <span class="hljs-built_in">return</span> out_line<br>            <br>def collect_string_resource(in_line):<br>    <span class="hljs-comment">#print in_line</span><br>    <span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> prefix_filter:<br>        <span class="hljs-keyword">if</span> in_line.find(prefix) &gt;=0:<br>            offset = in_line.find(prefix)<br>            <span class="hljs-keyword">if</span> offset &gt; 0 and in_line[offset-1] not <span class="hljs-keyword">in</span> &#123;<span class="hljs-string">&#x27; &#x27;</span>,<span class="hljs-string">&#x27;\t&#x27;</span>,<span class="hljs-string">&#x27;;&#x27;</span>&#125;:<br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-keyword">if</span> in_line.find(<span class="hljs-string">&#x27;(&#x27;</span>) == -1:<br>                <span class="hljs-built_in">break</span>;<br>            <span class="hljs-comment">#print in_line</span><br>            out_line = <span class="hljs-string">&quot;&quot;</span><br>            out_line = find_string_from_line(in_line,out_line)<br>            <span class="hljs-comment">#print &quot;collect_string_resource:&quot; +out_line</span><br>            <span class="hljs-built_in">return</span> out_line<br>    <span class="hljs-built_in">return</span> in_line<br>    <br>def filter_cpp_file(filepath):<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;filter_cpp_file:&quot;</span>+filepath<br>    write_buf = []<br>    try:<br>        f_in = open(filepath, mode = <span class="hljs-string">&#x27;rb&#x27;</span>)<br><br>        line = f_in.readline()<br>        slash_flag = 0<br>        <span class="hljs-keyword">while</span> line:<br>            <span class="hljs-comment">#line = line.split(&quot;\n&quot;)[0]</span><br>            <span class="hljs-keyword">if</span> line.find(<span class="hljs-string">&quot;//&quot;</span>) &gt;= 0:<br>                pos = line.find(<span class="hljs-string">&quot;//&quot;</span>)<br>                write_buf.append(collect_string_resource(line[0:pos]))<br>                write_buf.append(line[pos:])<br>            <span class="hljs-keyword">elif</span> line.find(<span class="hljs-string">&quot;/*&quot;</span>) &gt;= 0 and line.find(<span class="hljs-string">&quot;*/&quot;</span>) &gt;= 0: <br>                begin_pos = line.find(<span class="hljs-string">&quot;/*&quot;</span>)<br>                end_pos = line.find(<span class="hljs-string">&quot;*/&quot;</span>)<br>                write_buf.append(collect_string_resource(line[0:begin_pos]))<br>                write_buf.append(line[begin_pos:end_pos])<br>                write_buf.append(collect_string_resource(line[end_pos:]))<br>            <span class="hljs-keyword">elif</span> line.find(<span class="hljs-string">&quot;/*&quot;</span>) &gt;= 0:<br>                pos = line.find(<span class="hljs-string">&quot;/*&quot;</span>)<br>                write_buf.append(collect_string_resource(line[0:pos]))<br>                write_buf.append(line[pos:])<br>                slash_flag = 1<br>            <span class="hljs-keyword">elif</span> line.find(<span class="hljs-string">&quot;*/&quot;</span>) &gt;= 0:<br>                pos = line.find(<span class="hljs-string">&quot;*/&quot;</span>)<br>                write_buf.append(line[0:pos])<br>                write_buf.append(collect_string_resource(line[pos:]))<br>                slash_flag = 0<br>            <span class="hljs-keyword">elif</span> slash_flag == 1:<br>                write_buf.append(line)<br>                line = f_in.readline()<br>                <span class="hljs-built_in">continue</span><br>            <span class="hljs-keyword">else</span>:<br>                write_buf.append(collect_string_resource(line))       <br>            line = f_in.readline()<br>        f_in.close()<br>    except Exception as e:<br>        <span class="hljs-built_in">print</span> e<br>        <br>    f_out= open(filepath,<span class="hljs-string">&#x27;wb&#x27;</span>)<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> write_buf:<br>        f_out.write(line)<br>    f_out.close()<br>    <span class="hljs-built_in">return</span><br><br>def get_file_list(path):<br>    <span class="hljs-keyword">for</span> dirpath, dirnames, filenames <span class="hljs-keyword">in</span> os.walk(path):<br>        <span class="hljs-comment">#print &#x27;search path:&#x27;+dirpath</span><br>        <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> filenames:<br>            <span class="hljs-comment">#print &#x27;find file:&#x27;+filename</span><br>            <span class="hljs-keyword">if</span>(os.path.splitext(filename)[-1] <span class="hljs-keyword">in</span> filter):<br>                <span class="hljs-comment">#print os.path.join(dirpath, filename)</span><br>                fileList.append(os.path.join(dirpath, filename))<br>    <span class="hljs-built_in">return</span><br>    <br>def output_string_resource(filepath):<br>    global string_resource_map <br>    <span class="hljs-keyword">if</span> not string_resource_map:<br>        <span class="hljs-built_in">return</span><br>    f_out= open(filepath,<span class="hljs-string">&#x27;wb&#x27;</span>)<br>    <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> string_resource_map.items():<br>        f_out.write(str(v)+<span class="hljs-string">&quot;:&quot;</span>+k+<span class="hljs-string">&quot;\n&quot;</span>)<br>    f_out.close()<br>    <span class="hljs-built_in">return</span><br>    <br>def main():<br>    arg_cnt = len(sys.argv)<br>    <span class="hljs-keyword">if</span> arg_cnt!=3:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;usage: \&quot;python pack_string_resource.py cpp_file_root_dir string_resource_file_path\&quot;&quot;</span><br>        <span class="hljs-built_in">return</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;cpp_file_root_dir:&quot;</span>+sys.argv[1]<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;string_resource_file_path:&quot;</span>+sys.argv[2]<br>    get_file_list(sys.argv[1])<br>    <span class="hljs-comment">#print fileList</span><br>    <span class="hljs-keyword">for</span> filepath <span class="hljs-keyword">in</span> fileList:<br>        filter_cpp_file(filepath)<br>    output_string_resource(sys.argv[2])<br>    <span class="hljs-built_in">return</span><br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Reduce code zize</div>
      <div>http://xiazelong.com/2022/09/16/reduce-code-size/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>zelong xia</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>September 16, 2022</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>Licensed under</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/12/thread-dead-loop/" title="Thread dead loop -- auto variable">
                        <span class="hidden-mobile">Thread dead loop -- auto variable</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
